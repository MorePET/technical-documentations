---
type:
labels:	enhancement,security,devcontainer
comments:	0
assignees:
projects:
milestone:
number:	9
url:	https://github.com/MorePET/technical-documentations/issues/9
createdAt:	2025-11-07T15:12:28Z
updatedAt:	2025-11-07T15:12:28Z
---

# Implement linter user for protected config file security
https://github.com/MorePET/technical-documentations/issues/9

| State | Date | Type | Author | Assignees |
|-------|------|------|--------|-----------|
| ðŸ”µ OPEN | 2025-11-07 |  | gerchowl |  |

## Problem

Currently, linting configuration files (, , etc.) are protected with 444 permissions to prevent accidental modifications. However, running as root in the devcontainer means:

1. **Auto-fixing linters fail** - Permission denied when trying to fix protected files
2. **Manual chmod required** - Friction but no true security (root can chmod anyway)
3. **Swiss cheese has holes** - Single-layer protection, not defense-in-depth

## Proposed Solution

Implement a **dedicated linter user** with write access to config files, while root maintains read-only access:

### Architecture

```
User: root (uid=0)           â†’ Read-only (440) on config files
User: linter (uid=999)       â†’ Read-write (640) on config files
Group: linter (gid=999)      â†’ Write access to config files

Files owned by: linter:linter with 640 permissions
Pre-commit runs as: linter user (via wrapper script)
```

### Benefits

âœ… **True separation of privileges** - Root cannot write, linter can
âœ… **Auto-fixers work** - Linters run as linter user, can modify files
âœ… **Defense in depth** - Multiple barriers (user separation + permissions + warnings)
âœ… **Audit trail** - Any config changes visible as linter user actions
âœ… **Swiss cheese model** - Independent security layers

## Implementation Tasks

- [ ] Create `setup-linter-user.sh` script
  - Create linter user (uid=999, no login shell)
  - Create linter group
  - Set ownership of protected files to linter:linter
  - Set permissions to 640 (rw-r-----)

- [ ] Create wrapper script `/usr/local/bin/pre-commit-as-linter`
  - Execute pre-commit as linter user
  - Preserve all arguments
  - Alias to `pre-commit` command

- [ ] Integrate into `.devcontainer/post-create.sh`
  - Call setup-linter-user.sh during devcontainer creation
  - Ensure all developers get this setup automatically

- [ ] Update documentation
  - README.md - Explain security model
  - pre-commit documentation - How it works
  - Contributing guidelines - Manual intervention workflow

- [ ] Protected files list
  - `.pre-commit-config.yaml`
  - `pyproject.toml`
  - `.hadolint.yaml`
  - `.checkmake.ini`
  - `.yamllint`

## Manual Intervention Workflow

When root needs to modify protected config files:

```bash
# Option 1: Edit as linter user
sudo -u linter vim .pre-commit-config.yaml

# Option 2: Temporarily escalate (for emergency)
sudo chmod 644 .pre-commit-config.yaml
# ... make changes ...
sudo chown linter:linter .pre-commit-config.yaml
sudo chmod 640 .pre-commit-config.yaml
```

## Testing

Verify:
1. Root cannot write to config files âœ—
2. Linter user can write to config files âœ“
3. Pre-commit auto-fixers work without permission errors âœ“
4. CI/GitHub Actions work (644 from Git) âœ“
5. Warning comments remain visible âœ“

## Security Model

**Layer 1:** Warning comments - Visual deterrent
**Layer 2:** User separation - Root vs linter user
**Layer 3:** File permissions - 640 with linter ownership
**Layer 4:** No shell for linter - Can't login as linter
**Layer 5:** Audit trail - File ownership shows who can modify

## Related

- Current issue: Auto-fixing linters fail with permission denied
- Root cause: Running as root bypasses traditional permission checks
- Solution: User separation + proper ownership

## Priority

**High** - Blocks normal pre-commit workflow, requires manual chmod for config file fixes
